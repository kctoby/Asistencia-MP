--Función para APROBAR o DENEGAR un permiso ya sea el jefe inmediato o jefe temporal
CREATE OR REPLACE FUNCTION "PERMISOS".F_APR_DNG_PERMISO_JEFE_INM(IN P_ID_PERMISO INTEGER, IN P_VEREDICTO_PARTICULAR BOOLEAN,
	IN P_DESCRIPCION_DENEGACION_JEFE CHARACTER VARYING(100)) 
RETURNS VOID AS 
$BODY$
DECLARE
  v_fcambio_estado_jefe timestamp without time zone;
BEGIN
	v_fcambio_estado_jefe := to_char(current_timestamp, 'DD/MM/YYYY HH24:MI:SS')::timestamp without time zone;

	UPDATE "PERMISOS"."TBL_PERMISOS"
	SET "ESTADO_JEFE" = P_VEREDICTO_PARTICULAR, "F_CAMBIO_ESTADO_JEFE" = v_fcambio_estado_jefe, 
		"DESCRIPCION_DENEGACION_JEFE" = P_DESCRIPCION_DENEGACION_JEFE
	WHERE "ID_PERMISO" = P_ID_PERMISO;

END;
$BODY$ 
LANGUAGE 'plpgsql';


SELECT "PERMISOS".F_APR_DNG_PERMISO_JEFE_INM(7,'TRUE', 'APROBADO');
